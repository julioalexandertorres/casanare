<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1" />
  <!-- jQuery -->
  <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
  <!-- Openlayers -->
  <link rel="stylesheet" href="src/ol9/ol.css">
  <link rel="stylesheet" href="src/olext/olext.css">
 
  <script type="text/javascript" src="src/ol9/ol.js"></script>
  <script type="text/javascript" src="src/olext/ol-ext.js"></script>
  <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL,Object.assign"></script>
  
  <!-- Pointer events polyfill for old browsers, see https://caniuse.com/#feat=pointer -->
  <script src="https://unpkg.com/elm-pep"></script>
  <script src="sql/js_sql.js"></script>
  <!-- Font-GIS -->
  <link href="https://viglino.github.io/font-gis/css/font-gis.css" rel="stylesheet" />
  <link rel="stylesheet" href="style/style.css" />
  </head>
<body>
  <!-- DIV for the map -->
  <div id="compare" class="compare">
    <div id="map"></div>
    <div id="map2"></div>
  </div>
  <div class="tools">
    <i class="fg-screen-dub" onclick="setMode('compare')" title="Compare"></i>
    <i class="fg-screen-dub1" onclick="setMode('view1')" title="Map 1"></i>
    <i class="fg-screen-dub2" onclick="setMode('view2')" title="Map 2"></i>
    <i class="fg-screen-split-h" onclick="setMode('swipev')" title="Swipe V"></i>
    <i class="fg-screen-split-v" onclick="setMode('swipeh')" title="Swipe V"></i>
    <i class="fg-screen-mag-alt" onclick="setMode('clip')" title="Clip"></i>
  </div>


  <div class="select">
    <div
      class="selected"
      data-default="Ir a ..."
      data-one="Cabecera Municipal"
      data-two="Bajo Calima"
      data-three="Cisneros"
      data-four="Cordoba"
      data-five="El Crucero"
      data-six="Camino Viejo km 40"
      data-seven="Campo Hermoso"
      data-eight="La Delfina"
      data-nine="Katanga"
      data-ten="Bendiciones"
      data-eleven="Triana"
      data-twelve="Umane"
      data-thirteen="Villa Estela"
      data-fourteen="El Salto"
      data-fiveteen="Zaragosa"
      data-sixteen="Quebrada Pericos"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        height="1em"
        viewBox="0 0 512 512"
        class="arrow"
      >
        <path
          d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"
        ></path>
      </svg>
    </div>
    <div class="options">
      <div title="all">
        <input id="all" name="option" type="radio" checked="" />
        <label class="option" for="all" data-txt="Ir a ..."></label>
      </div>
      <div title="option-1">
        <input id="option-1" name="option" type="radio" />
        <label class="option" for="option-1" data-txt="Cabecera Municipal"></label>
      </div>
      <div title="option-2">
        <input id="option-2" name="option" type="radio" />
        <label class="option" for="option-2" data-txt="Bajo Calima"></label>
      </div>
      <div title="option-3">
        <input id="option-3" name="option" type="radio" />
        <label class="option" for="option-3" data-txt="Cisneros"></label>
      </div>
      <div title="option-4">
        <input id="option-4" name="option" type="radio" />
        <label class="option" for="option-4" data-txt="Cordoba"></label>
      </div>
      <div title="option-5">
        <input id="option-5" name="option" type="radio" />
        <label class="option" for="option-5" data-txt="El Crucero"></label>
      </div>
      <div title="option-6">
        <input id="option-6" name="option" type="radio" />
        <label class="option" for="option-6" data-txt="Camino Viejo km 40"></label>
      </div>
      <div title="option-7">
        <input id="option-7" name="option" type="radio" />
        <label class="option" for="option-7" data-txt="Campo Hermoso"></label>
      </div>
      <div title="option-8">
        <input id="option-8" name="option" type="radio" />
        <label class="option" for="option-8" data-txt="La Delfina"></label>
      </div>
      <div title="option-9">
        <input id="option-9" name="option" type="radio" />
        <label class="option" for="option-9" data-txt="Katanga"></label>
      </div>
      <div title="option-10">
        <input id="option-10" name="option" type="radio" />
        <label class="option" for="option-10" data-txt="Bendiciones"></label>
      </div>
      <div title="option-11">
        <input id="option-11" name="option" type="radio" />
        <label class="option" for="option-11" data-txt="Triana"></label>
      </div>
      <div title="option-12">
        <input id="option-12" name="option" type="radio" />
        <label class="option" for="option-12" data-txt="Umane"></label>
      </div>
      <div title="option-13">
        <input id="option-13" name="option" type="radio" />
        <label class="option" for="option-13" data-txt="Villa Estela"></label>
      </div>
      <div title="option-14">
        <input id="option-14" name="option" type="radio" />
        <label class="option" for="option-14" data-txt="El Salto"></label>
      </div>
      <div title="option-15">
        <input id="option-15" name="option" type="radio" />
        <label class="option" for="option-15" data-txt="Zaragosa"></label>
      </div>
      <div title="option-16">
        <input id="option-16" name="option" type="radio" />
        <label class="option" for="option-16" data-txt="Quebrada Pericos"></label>
      </div>
    </div>
  </div>

  <script type="text/javascript">

  

  // Layers
/*LAYERS IZQUIERDA*/  
var bingsatelite = new ol.layer.Tile({
    visible: true,
    //opacity: 0,
    source: new ol.source.BingMaps({
        key: 'AmTXzzix65q59DqR4_iobPZa9sNRcXtL4gkAsH-uww3RYpVFHGGejnUQTJev9ixC',
        imagerySet: 'AerialWithLabelsOnDemand'
    }), name: 'Satelite con Etiquetas',
    crossOrigin: 'anonymous'
});

var layerSatelite = new ol.layer.Group({
    layers: [bingsatelite],
    name: 'CAPAS BASE'
});


var munsel = window.location.search.substring(1);
var munsel = munsel.split("=");
var munsel = munsel[1];

/*LAYERS DERECHA*/
var capasortofoto = select_query("select * from capas where layer = 'ortofotos' order by id DESC");
var capasort = [];
try{
    for (i=0; i<capasortofoto.length; i++){
        capasort[i] = new ol.layer.Tile({
            visible: true,
            source: new ol.source.TileWMS({
                url: capasortofoto[i][1],
                params: {LAYERS: capasortofoto[i][3], STYLES: ''},
                serverType: 'geoserver',
                crossOrigin: 'anonymous'
            }), name: capasortofoto[i][3]
        });
    }
}
catch(err){}

var layerortofotos = new ol.layer.Group({
    layers: capasort,
    name: 'ORTOFOTOGRÁFIAS'
});


  if(munsel=='p8gf7hj'){
    var initialPosition = [-8575088, 432225];
  }
  else{
    var initialPosition = defaultAccessToken;
  }
  // The map
  var map = new ol.Map ({
    target: 'map',
    view: new ol.View ({
      zoom: 16,
      center: initialPosition
    }),
    layers: [layerSatelite]
  });

  var map2 = new ol.Map ({
    target: 'map2',
    view: new ol.View ({
      zoom: 16,
      center: initialPosition
    }),
    layers: [layerortofotos]
  });

  // Select interaction
  var select1 = new ol.interaction.Select({ condition: ol.events.condition.click });
  map.addInteraction(select1);
  var select2 = new ol.interaction.Select({ condition: ol.events.condition.click });
  map2.addInteraction(select2);

  var popup1 = new ol.Overlay.Popup({ anim: true, closeBox: true });
  map.addOverlay(popup1);
  var popup2 = new ol.Overlay.Popup({ anim: true, closeBox: true });
  map2.addOverlay(popup2);

  function showPopup(e, popup) {
    var feature = e.element;
    var content = "";
    if (!feature.get('text')) return;
    content += "<img src='"+feature.get("img")+"'/>";
    content += feature.get("text");
    if (/swipe/.test(currentMode)) {
      popup2.show(feature.getGeometry().getFirstCoordinate(), content); 
    } else {
      popup.show(feature.getGeometry().getFirstCoordinate(), content);
    }
  }
  function hidePopup() {
    popup1.hide(); 
    popup2.hide(); 
  }
  select1.getFeatures().on('add', function(e) { showPopup(e, popup1) });
  select2.getFeatures().on('add', function(e) { showPopup(e, popup2) });
  select1.getFeatures().on('remove', hidePopup);
  select2.getFeatures().on('remove', hidePopup);

  // Synchronize the maps 
  map.addInteraction( new ol.interaction.Synchronize({ maps: [map2] }) );
  map2.addInteraction( new ol.interaction.Synchronize({ maps: [map] }) );

  // Tools
  /* Use layer clipping * /
  var clip = new ol.interaction.Clip({ radius: 150, layers: map2.getLayers().getArray() });
  var swipe = new ol.control.Swipe({ rightLayers: map2.getLayers().getArray(),  });
  /*/
  var clip = new ol.interaction.ClipMap({ radius: 150 });
  var swipe = new ol.control.SwipeMap({ right: true  });
  /**/

  // Change mode
  var currentMode;
  function setMode(mode) {
    if (mode) {
      currentMode = mode;
      // Remove tools
      map2.removeControl(swipe);
      map2.removeInteraction(clip);
      // Set interactions
      switch (mode) {
        case 'swipev':
        case 'swipeh': {
          map2.addControl(swipe);
          swipe.set('orientation', (mode==='swipev' ? 'vertical' : 'horizontal'));
          break;
        }
        case 'clip': {
          map2.addInteraction(clip);
          break;
        }
      }
      // Update position
      document.getElementById("compare").className = mode;
      select1.getFeatures().clear();
      select2.getFeatures().clear();
    }
    map.updateSize();
    map2.updateSize();
  }

  // Check click and dispatch to map
  map2.on('click', function(e) {
    if (/swipe/.test(currentMode)) {
      if (!ol.extent.containsCoordinate(swipe.getRectangle(), e.pixel)) {
        // Simulate map1 selection
        e.map = map;
        e.stopPropagation();
        select2.getFeatures().clear();
        select1.handleEvent(e);
      } else {
        select1.getFeatures().clear();
      }
    }
  });


  document.addEventListener('DOMContentLoaded', () => {
  const options = document.querySelectorAll('.options input[type="radio"]');

  options.forEach(option => {
    option.addEventListener('change', function() {
      if (this.checked) {
        const selectedOption = this.parentElement.getAttribute('title');
        console.log('Opción seleccionada:', selectedOption);
        if(selectedOption=='option-1'){
            var pgetextent = [-8577577.242673, 430415.180093, -8570988.574544, 433654.199654];
            map.getView().fit(pgetextent, {size: map.getSize()});
        }
        else if(selectedOption=='option-2'){
            var pgetextent = [-8569841.308454, 444826.052688, -8567720.004517, 445981.747501];
            map.getView().fit(pgetextent, map.getSize());
        }
        else if(selectedOption=='option-3'){
            var pgetextent = [-8546109.816534, 420353.145134, -8543535.016843, 421755.543091];
            map.getView().fit(pgetextent, map.getSize());
        }
        else if(selectedOption=='option-4'){
            var pgetextent = [-8564784.077793, 431060.894889, -8562160.256079, 432490.153697];
            map.getView().fit(pgetextent, map.getSize());
        }
        else if(selectedOption=='option-5'){
            var pgetextent = [-8569987.339048, 438099.374370, -8568686.039104, 438808.274310];
            map.getView().fit(pgetextent, map.getSize());
        }
        else if(selectedOption=='option-6'){
            var pgetextent = [-8552897.876482, 430351.482625, -8552005.993630, 430837.306596];
            map.getView().fit(pgetextent, map.getSize());
        }
        else if(selectedOption=='option-7'){
            var pgetextent = [-8576020.480755, 425045.967976, -8574386.792344, 425935.818515];
            map.getView().fit(pgetextent, map.getSize());
        }
        else if(selectedOption=='option-8'){
            var pgetextent = [-8548455.165078, 424910.234481, -8546166.375653, 426156.911265];
            map.getView().fit(pgetextent, map.getSize());
        }
        else if(selectedOption=='option-9'){
            var pgetextent = [-8550004.665711, 428723.535887, -8548558.541777, 429511.252259];
            map.getView().fit(pgetextent, map.getSize());
        }
        else if(selectedOption=='option-10'){
            var pgetextent = [-8551799.807735, 430510.900802, -8550904.864156, 430998.392829];
            map.getView().fit(pgetextent, map.getSize());
        }
        else if(selectedOption=='option-1'){
            var pgetextent = [-8550570.592373, 429473.563333, -8549263.532581, 430185.535594];
            map.getView().fit(pgetextent, map.getSize());
        }
        else if(selectedOption=='option-11'){
            var pgetextent = [-8590682.545027, 416736.367632, -8589618.516656, 417315.880435];
            map.getView().fit(pgetextent, map.getSize());
        }
        else if(selectedOption=='option-12'){
            var pgetextent = [-8567801.461000, 433691.475312, -8565818.350339, 434771.751591];
            map.getView().fit(pgetextent, map.getSize());
        }
        else if(selectedOption=='option-13'){
            var pgetextent = [-8549326.896439, 427186.254413, -8547905.328292, 427960.582463];
            map.getView().fit(pgetextent, map.getSize());
        }
        else if(selectedOption=='option-14'){
            var pgetextent = [-8556087.512345, 429561.936432, -8554639.514978, 430350.680256];
            map.getView().fit(pgetextent, map.getSize());
        }
        else if(selectedOption=='option-15'){
            var pgetextent = [-8549607.059510, 427852.343379, -8547866.270768, 428800.558361];
            map.getView().fit(pgetextent, map.getSize());
        }
      }
    });
  });
});


  </script>
  
</body>
</html>